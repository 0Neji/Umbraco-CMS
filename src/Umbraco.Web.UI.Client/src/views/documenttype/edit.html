<form novalidate name="contentTypeForm"
      ng-controller="Umbraco.Editors.DocumentType.EditController"
      ng-submit="save()"
      val-form-manager>

    <umb-editor-view>

        <umb-editor-header
                name="contentType.name"
                menu="page.menu"
                actions="page.actions">
        </umb-editor-header>

        <umb-editor-container class="editors-document-type-container">

            <div class="editors-document-type-canvas" ng-class="{'is-in-sorting-mode': sortingMode}">

                <!-- TOOLBAR -->
                <div class="toolbar clearfix">
                    <div class="toolbar-tools">

                        <a href="" class="toolbar-tool">
                            <i class="icon icon-merge"></i>
                            <span>Compositions</span>
                        </a>

                        <a href="" class="toolbar-tool" ng-click="toggleSortingMode()" ng-class="{'is-active': sortingMode}">
                            <i class="icon icon-navigation"></i>
                            <span>Reorder</span>
                        </a>

                    </div>
                </div>

                <!-- TABS -->
                <ul ui-sortable="sortableOptionsTab" ng-model="contentType.groups" class="no-style-list">

                    <li ng-repeat="tab in contentType.groups">

                        <!-- TAB INIT STATE -->
                        <!-- ng-if="tab.tabState=='init'" -->
                        <div class="edt-tab umb-card edt-tab-placeholder" ng-click="addTab(tab)" ng-show="tab.tabState=='init' && !sortingMode" ng-class="{'tab-state-init animated fadeIn': tab.tabState=='init'}">

                            <div class="tab-title">
                                <span class="tab-title-text"></span>
                            </div>

                            <div class="edt-tab-center-text">
                                <span ng-if="contentType.groups.length === 0">Add first tab</span>
                                <span ng-if="contentType.groups.length !== 0">Add new tab</span>
                            </div>

                        </div>


                        <!-- TAB ACTIVE OR INACTIVE STATE -->
                        <div class="edt-tab umb-card edt-tab-handle" ng-class="{'tab-state-active':tab.tabState=='active', 'tab-state-inactive': tab.tabState=='inActive'}" ng-click="activateTab(tab)" ng-if="tab.tabState !== 'init'">

                            <div class="tab-title">
                                <i class="icon icon-navigation" ng-if="sortingMode"></i>
                                <input class="tab-title-input" type="text" ng-model="tab.name" ng-class="{'tab-title-placeholder': tab.name == ''}" ng-change="updateTabTitle(tab)" umb-blur="updateTabTitle(tab)" umb-auto-focus umb-auto-resize />
                            </div>

                            <!--
                            <div tabindex="-1" class="edt-tab-actions">

                                <div class="tab-action">
                                    <div href="" class="umb-btn-round umb-btn-round-small" ng-click="deleteTab($index)">
                                        <i class="icon icon-trash"></i>
                                    </div>
                                </div>

                                <div class="tab-action edt-tab-handle" ng-if="contentType.groups.length > 1">
                                    <div href="" class="umb-btn-round umb-btn-round-small">
                                        <i class="icon icon-navigation"></i>
                                    </div>
                                </div>

                            </div>
                            -->


                            <div class="edt-property-group">
                                <ul class="edt-property-list no-style-list" ui-sortable="sortableOptionsEditor"
                                    ng-model="tab.properties" class="no-style-list">
                                    <li ng-repeat="property in tab.properties">

                                        <!-- Init property / Property placeholder / add new property -->
                                        <div class="edt-property" ng-show="property.propertyState=='init'" ng-class="{'property-state-init animated fadeIn': property.propertyState=='init'}" ng-click="choosePropertyType(property, tab)">

                                            <div class="edt-property-meta">
                                                <div class="placeholder-input-small"></div>
                                                <div class="placeholder-input"></div>
                                                <div class="placeholder-text-group">
                                                    <div class="placeholder-text-line-full"></div>
                                                    <div class="placeholder-text-line-full"></div>
                                                    <div class="placeholder-text-line-short"></div>
                                                </div>
                                            </div>

                                            <div class="edt-property-preview">
                                                <div class="placeholder">
                                                    <span class="placeholder-text">Add property</span>
                                                </div>
                                            </div>

                                            <div class="edt-property-actions"></div>

                                        </div>

                                        <div class="edt-property" ng-show="property.propertyState!=='init'" ng-class="{'active': property.dialogIsOpen, 'property-state-active animated fadeIn': property.propertyState=='active'}">


                                            <!-- property meta text -->
                                            <div class="edt-property-meta" ng-class="{'edt-property-handle': sortingMode}">

                                                <div ng-if="!sortingMode">
                                                    <div class="edt-property-meta-alias invisible-field">
                                                        <input type="text" placeholder="Alias.." ng-model="property.alias">
                                                    </div>

                                                    <div class="edt-property-meta-label invisible-field">
                                                        <input type="text" placeholder="Label.." ng-model="property.label" ng-change="changePropertyLabel(property)" />
                                                    </div>

                                                    <div class="edt-property-meta-description invisible-field">
                                                        <textarea ng-model="property.description" placeholder="Enter your description..."></textarea>
                                                    </div>
                                                </div>

                                                <div ng-if="sortingMode">
                                                    <i class="icon icon-navigation"></i>
                                                    <span>{{ property.label }}</span>:
                                                    <span class="item-alias">{{ property.alias }}</span>
                                                </div>

                                            </div>

                                            <!-- property preview -->
                                            <!-- ng-if="tab.tabState=='active'" -->
                                            <div tabindex="-1" class="edt-property-preview" ng-click="choosePropertyType(property)">

                                                <span class="edt-property-preview-overlay">
                                                    <span class="overlay-text">Choose property type</span>
                                                </span>

                                                <span class="edt-property-preview-label">
                                                    <span ng-if="property.dataType.name !== undefined">{{property.dataType.name}}</span>
                                                    <span ng-if="property.dataType.name == undefined">Preview</span>
                                                </span>

                                                <umb-property-editor model="property" ng-if="property.view !== undefined"></umb-property-editor>

                                            </div>

                                            <!-- row tools -->
                                            <div tabindex="-1" class="edt-property-actions">

                                                <!-- delete property -->
                                                <a href="" class="property-action property-action-delete" ng-click="deleteProperty(tab, $index)">
                                                    <i class="icon icon-trash"></i>
                                                </a>

                                                <!-- settings for property -->
                                                <a href="" class="property-action property-action-edit" ng-click="editPropertyTypeSettings(property)">
                                                    <i class="icon icon-settings"></i>
                                                </a>

                                            </div>

                                        </div>

                                    </li>

                                </ul>
                            </div>

                        </div>

                    </li>

                    <li>
                        <pre>{{ contentType | json }}</pre>
                    </li>


                </ul>
            </div>

        </umb-editor-container>


        <umb-editor-footer>
            <button type="submit" data-hotkey="ctrl+s" class="btn btn-success">
                <localize key="buttons_save">Save</localize>
            </button>
        </umb-editor-footer>

    </umb-editor-view>


    <!-- overlay for change property editor -->
    <umb-overlay
            ng-style="{'width': '500px'}"
            ng-if="showDialog"
            model="dialogModel"
            animation="slide-in-right"
            position="right"
            view="dialogModel.view">
    </umb-overlay>


</form>