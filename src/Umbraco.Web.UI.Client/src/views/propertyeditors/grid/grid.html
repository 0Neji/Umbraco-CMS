<div ng-controller="Umbraco.PropertyEditors.GridController" class="usky-grid">


    <!-- Template picker -->
    <div class="uSky-templates tb" ng-show="!model.value || model.value == ''">
        <div class="tr">
            <div class="td middle">
                <div class="uSky-templates-template" ng-repeat="template in uSkyGridConfig" style="">
                    <div class="tb" ng-click="addTemplate(template)">
                        <div class="tr">
                            <div class="td uSky-templates-column" 
                                ng-class="{last:$last}" 
                                ng-repeat="column in template.columns" 
                                style="width:{{ column.percentage }}%">
                            </div>
                        </div>
                    </div>
                </div>

                <br/>
                <div class="help-text">To start, select a layout for your grid</div>
            </div>
        </div>
    </div>
    <!-- template picker end -->

    <!-- Grids -->
    <div class="usky-grid-width" style="width:{{ model.value.gridWidth }}px">
        <div class="tb">

            <!-- for each column in model -->
            <div 
                class="usky-column td" 
                ng-class="{last:$index==model.value.columns.length-1}" 
                ng-repeat="column in model.value.columns" 
                style="width:{{column .percentage}}%">

                <div ui-sortable="sortableOptions" ng-model="column.rows">
                    
                    <!-- for each row in column -->
                    <div 
                        ng-repeat="row in column.rows" 
                        class="usky-row"
                        ng-mouseover="setCurrentRow(row)" 
                        ng-mouseleave="disableCurrentRow()"
                        ng-class="{removingControl:currentRemoveControl == row, movingControl:currentMoveControl == row}">

                        <!-- Row tool -->
                        <div class="row-tools" ng-animate="'fade'" 
                            ng-if="currentRow == row && currentControl === null">

                            <!-- delete row -->
                            <div class="cell-tools-remove">
                                <div class="iconBox"
                                    ng-click="deletePrompt = true"
                                    ng-mouseover="setCurrentRemoveControl(row)" 
                                    ng-mouseleave="disableCurrentRemoveControl(row)">
                                    
                                    <span ng-if="deletePrompt">
                                        Are you sure? 
                                            <a href style="text-decoration: underline" ng-click="removeRow(column, $index)">Yes</a> 
                                    </span>

                                    <i ng-if="!deletePrompt" class="icon icon-trash"></i>
                                </div>
                            </div>

                            <div class="cell-tools-move">
                                <div class="iconBox"
                                    ng-mouseover="setCurrentMoveControl(row)" 
                                    ng-mouseleave="disableCurrentMoveControl(row)">
                                    <i class="icon icon-navigation"></i>
                                </div>
                            </div>
                        </div>

                        <!-- row container -->
                        <div 
                            ng-class="{last:$index==model.value.length-1,first:$first}" 
                            class="{{row.cssClass}} mainContainer">

                            <div class="mainTb">
                                <div class="tb">
                                    <div class="tr">

                                        <!-- cells in row -->
                                        <div 
                                            style="width:{{ cell.model.percentage }}%"
                                            ng-class="{last:$index==row.cells.length-1,first:$first}"
                                            class="td mainTd usky-cell"
                                            ng-repeat="cell in row.cells">                    

                                            <!-- if cell is empty tools -->
                                            <div 
                                                class="usky-control usky-control-placeholder"
                                                ng-if="cell.controls.length == 0">

                                                <div 
                                                    ng-if="cell.model.allowed && cell.model.allowed.length === 1" 
                                                    ng-init="singleEditor = getEditor(cell.model.allowed[0])" 
                                                    class="cell-tools-add-single single-editor-{{singleEditor.alias}}">
                                                    
                                                    <a href ng-click="addControl(singleEditor, cell)">
                                                        <i class="icon {{singleEditor.icon}}"></i>
                                                        <div class="help-text">{{singleEditor.name}}</div>
                                                    </a>

                                                    <p class="placeholder" ng-click="addControl(singleEditor, cell)"> 
                                                        Start writing here...
                                                    </p>
                                                </div>

                                                <div ng-if="!cell.model.allowed || cell.model.allowed.length > 1">

                                                    <p class="placeholder" ng-click="addTinyMce(cell)"> 
                                                        Start writing here...
                                                    </p>

                                                    <div class="cell-tools-add"> 
                                                        <div
                                                            class="iconBox" 
                                                            ng-repeat="editor in availableEditors track by editor.alias"
                                                            ng-click="addControl(editor,cell)"
                                                            ng-show="allowedControl(editor, cell)">
                                                                <i class="icon {{editor.icon}}"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>


                                            <!-- Controls in cell -->
                                            <div
                                                ng-repeat="control in cell.controls"
                                                ng-class="{last:$index==cell.controls.length-1,
                                                        removingControl:currentRemoveControl == control,
                                                        toolsControl:currentToolsControl == control,
                                                        selectedControl:currentControl == control}"
                                                ng-mouseover="setCurrentControl(control)" 
                                                ng-mouseleave="disableCurrentControl(control)"
                                                ng-init="setEditorPath(control); controlIndex = $index;"
                                                class="usky-control">

                                               
                                                <!-- Filled cell tools -->
                                                <div class="cell-tools"
                                                    ng-animate="'fade'" 
                                                    ng-if="control && ( currentControl == control)">

                                                    
                                                    <div class="cell-tools-add" 
                                                        ng-if="cell.model.max === undefined || cell.model.max < cell.controls.length" 
                                                        ng-mouseover="setCurrentToolsControl(control)" 
                                                        ng-mouseleave="disableCurrentToolsControl(control)">

                                                        <div 
                                                            class="iconBox" 
                                                            ng-repeat="editor in availableEditors"
                                                            ng-click="addControl(editor,cell, controlIndex)"
                                                            ng-show="(currentToolsControl == control) && allowedControl(editor, cell)">
                                                                <i class="icon {{editor.icon}}"></i>
                                                        </div>

                                                        <div class="iconBox" 
                                                            ng-if="currentToolsControl != control">
                                                            <i class=" icon icon-add"></i>
                                                        </div>
                                                    </div>

                                                    <!-- delete cell -->
                                                    <div class="cell-tools-remove">    
                                                        <div class="iconBox"
                                                            ng-click="deletePrompt = true"
                                                            ng-mouseover="setCurrentRemoveControl(control)" 
                                                            ng-mouseleave="disableCurrentRemoveControl(control)">
                                                            
                                                            <span ng-if="deletePrompt">
                                                                Are you sure? 
                                                                    <a href style="text-decoration: underline" ng-click="removeControl(cell, controlIndex)">Yes</a> 
                                                            </span>

                                                            <i ng-if="!deletePrompt" class="icon icon-trash"></i>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Redering the editor for specific control -->
                                                <div 
                                                    ng-if="control && control.editorPath" 
                                                    ng-include="control.editorPath"
                                                    class="usky-cell usky-cell-{{control.editor.view}}">
                                                </div>
                                            </div>
                                            <!-- Controls repeat end -->

                                        </div>
                                        <!-- cells repeat end -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- row container end -->

                    </div>
                    <!-- row repeat -->

                </div>
                <!-- row sortable end -->

                <!-- column tools -->
                <div class="usky-templates-columns tb">

                    <div class="tr">
                        <div class="td middle">
                            <ul>
                                <li ng-repeat="cellModel in column.cellModels">
                                    <div class="tb mainTbpt" ng-click="addRow(column, cellModel)">
                                        <div class="tr">
                                            <div style="width:{{ cell.percentage; }}%" class="middle mainTdpt td" ng-repeat="cell in cellModel.models">
                                                <i class="icon {{cellPreview(cell)}}"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <small>{{cellModel.name}}</small>
                                </li>
                            </ul>

                        </div>
                    </div>
                    <div class="tr">
                        <div class="td middle">
                            <br/>
                            <span class="help-text">Add rows to your layout</span>
                        </div>
                    </div>
                </div>
                <!-- column tools end -->

            </div>
            <!-- column repeat end -->

        </div>
    </div>
    <!-- grid wrapper end -->

</div>