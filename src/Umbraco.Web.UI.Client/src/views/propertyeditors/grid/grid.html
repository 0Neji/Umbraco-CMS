<div ng-controller="Umbraco.PropertyEditors.GridController" class="usky-grid">
    <!-- Template picker -->
    <div class="uSky-templates tb" ng-show="!model.value || model.value == ''">
        <div class="tr">
            <div class="td middle">
                <div class="uSky-templates-template" ng-repeat="template in uSkyGridConfig" style="">
                    <div class="tb" ng-click="addTemplate(template)">
                        <div class="tr">
                            <div class="td uSky-templates-column" ng-class="{last:$index==template.columns.length-1}" ng-repeat="column in template.columns" style="width:{{ column.percentage }}%">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Grids -->
    <div class="usky-grid-width" style="width:{{ model.value.gridWidth }}px">
    <div class="tb">

    <div class="usky-column td" ng-class="{last:$index==model.value.columns.length-1}" ng-repeat="column in model.value.columns" style="width:{{column .percentage}}%">

    <div ui-sortable="sortableOptions" ng-model="column.rows">

    <div 
        ng-repeat="row in column.rows" 
        class="usky-row"
        ng-mouseover="setCurrentRow(row)" 
        ng-mouseleave="disableCurrentRow()"
        ng-class="{removingControl:currentRemoveControl == row}">

    <div class="row-tools" ng-if="currentRow == row">
        <div class="cell-tools-remove">
            <div class="iconBox"
                ng-click="removeRow(column, $index)"
                ng-mouseover="setCurrentRemoveControl(row)" 
                ng-mouseleave="disableCurrentRemoveControl(row)">
                <i class="icon icon-trash"></i>
            </div>
        </div>
    </div>

    <div ng-class="{last:$index==model.value.length-1,first:$index==0}" 
        class="{{row.cssClass}} mainContainer">

    <div class="mainTb">
        <div class="tb">

    <div class="tr">
        <div style="width:{{ cell.model.percentage }}%"
             ng-class="{last:$index==row.cells.length-1,first:$index==0}"
             class="td mainTd"

             ng-repeat="cell in row.cells">

    <div ng-repeat="control in cell.controls"
         ng-class="{backColor:!control.tinyMCE,
                    last:$index==cell.controls.length-1,
                    removingControl:currentRemoveControl == control,
                    toolsControl:currentToolsControl == control,
                    selectedControl:currentControl == control || isOpenRTEToolbar(control),
                    jumbotron:row.boxed}"
         ng-mouseover="setCurrentControl(control)" 
         ng-mouseleave="disableCurrentControl(control)"
         class="controlContainer">

    <!-- Empty cell tools -->
    <div class="cell-tools" 
        ng-if="control && ( currentControl == control || isOpenRTEToolbar(control) )">

        <div class="cell-tools-add" 
            ng-if="model.config.items.enableMultiCells" 
            ng-mouseover="setCurrentToolsControl(control)" 
            ng-mouseleave="disableCurrentToolsControl(control)">
                                                        
            <div class="iconBox" 
                ng-click="addTinyMce(cell, $index)" 
                ng-if="(currentToolsControl == control) && model.config.items.enableRte">
                    <i class="icon icon-edit"></i>
            </div>
            
            <div class="iconBox" 
                ng-click="addMedia(cell, $index)" 
                ng-if="(currentToolsControl == control) && model.config.items.enableMedia">
                    <i class="icon icon-picture"></i>
            </div>

            <div class="iconBox" 
                ng-click="addMacro(cell, $index)" 
                ng-if="(currentToolsControl == control) && model.config.items.enableMacro">
                <i class="icon icon-settings-alt"></i>
            </div>

            <div class="iconBox" 
                ng-if="currentToolsControl != control">
                <i class=" icon icon-add"></i>
            </div>
        </div>

        <div class="cell-tools-remove">    
            <div class="iconBox"
                ng-click="removeControl(cell, $index)"
                ng-mouseover="setCurrentRemoveControl(control)" 
                ng-mouseleave="disableCurrentRemoveControl(control)">
                <i class="icon icon-trash"></i>
            </div>
        </div>
    </div>

    <!-- Tiny cell -->
    <div ng-if="control && control.tinyMCE"
         ng-class="{cellPanelRte:1==1,hideRTEToolbar:!isOpenRTEToolbar(control)}">

        <!--<div ng-controller="uSky.Grid.Rte.controler">
            <textarea ng-model="control.tinyMCE" rows="10" id="{{control.tinyMCE.uniqueId}}"></textarea>
        </div>-->

        <div ng-if="control.tinyMCE"
             unique-id="control.tinyMCE.uniqueId"
             value="control.tinyMCE.value"
             ctrl-op="openRTEToolbar(control)"
             ctrl-cl="closeRTEToolbar(control)"
             grid-rte configuration="model.config.rte"></div>

    </div>

    <!-- Media cell -->
    <div ng-if="control && control.media" class="cellMedia">
        <img ng-src="{{control.media.src}}" class="fullSizeImage" />
    </div>

    <!-- Macro cell -->
    <div ng-if="control && control.macro" class="cellMacro">
        <div class="tools">
            <i class="icon icon-settings-alt"></i>
            {{control.macro.macroAlias}}
        </div>
    </div>

    </div>

    <!-- Empty cell tools -->
    <div class="cellPanel"
        ng-if="cell.controls.length == 0">
        

        <p class="placeholder" 
        ng-click="addTinyMce(cell)"> 
            Start writing here...
        </p>

        <div class="iconBox" ng-click="addTinyMce(cell)" ng-if="(cell.controls.length == 0 || currentCell == cell) && model.config.items.enableRte">
            <i class="icon icon-edit"></i>
        </div>

        <div class="iconBox" ng-click="addMedia(cell)" ng-if="(cell.controls.length == 0 || currentCell == cell) && model.config.items.enableMedia">
            <i class="icon icon-picture"></i>
        </div>
        
        <div class="iconBox" ng-click="addMacro(cell)" ng-if="(cell.controls.length == 0 || currentCell == cell) && model.config.items.enableMacro">
            <i class="icon icon-settings-alt"></i>
        </div>

    </div>



                                        </div>

                                    </div>
                                </div>

                            </div>

                        </div>

                    </div>

                </div>

                <br />

                <div class="tb">
                    <div class="tr">
                        <div class="td middle">
                            <i class="icon-color icon icon-add large"></i>
                        </div>
                    </div>
                    <div class="tr">
                        <div class="td middle">
                            <ul>
                                <li ng-repeat="cellModel in column.cellModels">
                                    <div class="tb mainTbpt" ng-click="addRow(column, cellModel)">
                                        <div class="tr">
                                            <div style="width:{{ cell.percentage; }}%" class="middle mainTdpt td" ng-repeat="cell in cellModel.models"></div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

            </div>

        </div>

    </div>

</div>