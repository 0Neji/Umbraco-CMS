<div ng-controller="Umbraco.PropertyEditors.GridController" class="umb-grid umb-editor" id="umb-grid">

    <div ng-if="contentReady">

        <!-- Template picker -->

        <div class="templates-preview"
             ng-show="!model.value || model.value == ''">

             <p><!--<span class="help-text"><localize key="grid_addRows"/></span>--><strong>Choose layout for this section</strong></p>

            <div class="preview-rows layout"
                 ng-repeat="template in model.config.items.templates"
                 ng-click="addTemplate(template)">

                <div class="preview-row">

                    <div class="preview-col"
                         ng-class="{last:$last}"
                         ng-repeat="section in template.sections"
                         ng-style="{width: percentage(section.grid) + '%'}">

                        <div class="preview-cell">
                        </div>

                    </div>

                </div>

                <div class="preview-overlay">
                </div>

                <small>{{template.name}}</small>

            </div> <!-- .templates-preview-rows -->

        </div> <!-- .templates-preview -->
        <!-- template picker end -->
        <!-- Grids -->
        <div class="umb-grid-width">
            <div class="tb">

                <!-- for each column in model -->
                <div class="umb-column td"
                     ng-class="{last:$last}"
                     ng-repeat="section in model.value.sections"
                     ng-init="initSection(section)"
                     ng-style="{width: section.$percentage + '%'}">

                    <div ui-sortable="sortableOptions" ng-model="section.rows">

                        <!-- for each row in template section -->
                        <!-- ng-mouseenter="setCurrentRow(row)" -->
                        <!-- ng-mouseleave="disableCurrentRow()"  -->
                        <div class="umb-row"
                             ng-repeat="row in section.rows"
                             ng-click="clickRow(row, $event)"
                             ng-class="{
                                     '-has-config': hasConfig(row),
                                     '-active': currentRow === row,
                                     '-editor-active': currentCell !== null && currentRow === row || currentControl !== null && currentRow === row}"
                             on-outside-click="clickOutsideRow()">



                            <div class="umb-row-title-bar">

                                <div class="umb-row-title">{{row.name}}</div>

                               <!-- Row tool -->
                               <div class="row-tools" ng-show="currentRow === row">

                                   <div class="cell-tools-edit" ng-if="hasSettings">
                                       <a ng-mouseover="setInfohighlightRow(row)"
                                          ng-mouseleave="disableInfohighlightRow(row)"
                                          ng-click="editGridItemSettings(row, 'row')"
                                          href>
                                           <i class="icon icon-settings" title="@grid_settings" localize="title"></i>
                                       </a>
                                   </div>

                                    <div class="cell-tools-remove">
                                        <i class="icon-trash" ng-click="togglePrompt(row)"></i>
                                        <umb-confirm-action
                                            ng-if="row.deletePrompt"
                                            direction="right"
                                            on-confirm="removeRow(section, $index)"
                                            on-cancel="hidePrompt(row)">
                                        </umb-confirm-action>
                                    </div>

                               </div>

                               <div class="umb-grid-has-config" ng-if="hasConfig(row)">
                                  Styles is applied
                               </div>

                            </div>

                            <!-- row container -->
                            <div class="{{row.cssClass}} umb-row-inner"
                                 ng-class="{last:$last,
                                            first:$first,
                                            warnhighlight:currentWarnhighlightRow == row,
                                            infohighlight:currentInfohighlightRow == row,
                                            selectedRow:currentRow == row && currentControl === null}">

                                <div class="mainTb">
                                    <div class="tb">
                                        <div class="tr">

                                            <!-- Areas in row -->
                                            <div class="umb-cell td mainTd"
                                                 ng-repeat="area in row.areas"
                                                 ng-style="{width: area.$percentage + '%'}"
                                                 ng-class="{
                                                    'last':$last,
                                                    'first':$first,
                                                    'infohighlight':currentInfohighlightArea == area,
                                                    'warnhighlight':currentWarnhighlightArea == area,
                                                    '-has-config' :hasConfig(area),
                                                    '-active': currentCell == area}"
                                                    ng-model="area.controls"
                                                 ng-click="clickCell(area, row, $event)">

                                                 <!-- Cell placeholder -->
                                                 <div class="umb-cell-content -placeholder"
                                                      ng-if="area.controls.length === 0"
                                                      ng-click="openEditorOverlay($event, area, 0, area.$uniqueId);">
                                                      <a href="" class="cell-tools-add -center">Add content</a>
                                                 </div>

                                                 <!-- Cell with editors -->
                                                 <div class="umb-cell-content -has-editors"
                                                      ng-if="area.controls.length > 0"
                                                      ng-class="{'-active': currentCell == area}"
                                                      ui-sortable="sortableOptionsCell">

                                                      <div class="umb-grid-has-config" ng-if="hasConfig(area)">
                                                         Styles is applied
                                                      </div>

                                                      <div class="cell-tools" ng-if="currentCell == area">
                                                         <div class="cell-tool" ng-click="editGridItemSettings(area, 'cell')">
                                                            <i class="icon-settings"></i>
                                                         </div>
                                                      </div>

                                                      <!-- Controls in areas -->
                                                      <!-- ng-mouseover="setCurrentControl(control)" -->
                                                      <!-- ng-mouseleave="disableCurrentControl(control)" -->
                                                      <div ng-repeat="control in area.controls"
                                                          ng-click="clickControl(control, area, row, $event)"
                                                          ng-class="{'-active': currentControl === control}"
                                                          ng-animate="'fade'"
                                                          class="umb-control">

                                                          <div class="umb-control-click-overlay" ng-if="currentControl !== control"></div>

                                                          <div class="umb-control-inner" ng-class="{last:$last,
                                                                     infohighlight:currentInfohighlightControl == control,
                                                                     warnhighlight:currentWarnhighlightControl == control,
                                                                     selectedControl:currentControl == control}">

                                                               <div class="umb-control-bar">

                                                                  <div class="umb-control-title" ng-if="currentControl == control">
                                                                     {{control.editor.name}}
                                                                  </div>

                                                                  <div class="umb-control-tools" ng-if="currentControl == control">

                                                                    <div class="umb-control-tool">
                                                                        <i class="umb-control-tool-icon icon-trash"  ng-click="togglePrompt(control)"></i>
                                                                        <umb-confirm-action
                                                                            ng-if="control.deletePrompt"
                                                                            direction="right"
                                                                            on-confirm="removeControl(area, $index)"
                                                                            on-cancel="hidePrompt(control)">
                                                                        </umb-confirm-action>
                                                                    </div>

                                                                  </div>

                                                               </div>

                                                             <!-- Redering the editor for specific control -->
                                                             <div ng-if="control && control.$editorPath"
                                                                   ng-include="control.$editorPath"
                                                                   class="umb-cell-{{control.editor.view}}">
                                                             </div>

                                                          </div>
                                                      </div>
                                                   <!-- Controls repeat end -->
                                                   <!-- if area is empty tools -->

                                                   <a href="" class="cell-tools-add -bar" ng-click="openEditorOverlay($event, area, 0, area.$uniqueId);">Add content</a>

                                                 </div>

                                            </div>
                                            <!-- cells repeat end -->

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- row container end -->

                        </div>
                        <!-- row repeat -->

                    </div>
                    <!-- row sortable end -->
                    <!-- column tools -->

                    <div class="umb-add-row">

                       <a href=""
                          class="iconBox"
                          ng-click="toggleAddRow()"
                          ng-if="!showRowConfigurations">

                          <i class=" icon icon-add" title="@general_add" localize="title"></i>

                       </a>

                    </div>

                    <div class="templates-preview" ng-if="showRowConfigurations">

                        <p ng-hide="section.rows.length > 0"><strong>Choose row</strong><!-- <span class="help-text"><localize key="grid_addRows" /></span> --></p>

                        <div class="preview-rows columns"
                             ng-repeat="layout in  section.$allowedLayouts"
                             ng-show="layout.areas.length > 0"
                             ng-click="addRow(section, layout)">

                            <div class="preview-row">

                                <div class="preview-col" ng-style="{width: percentage(area.grid) + '%'}" ng-repeat="area in layout.areas">

                                    <div class="preview-cell">
                                    </div>

                                </div>

                            </div>

                            <div class="preview-overlay">
                            </div>

                            <small>{{layout.name}}</small>

                        </div> <!-- .templates-preview-rows -->

                    </div> <!-- .templates-preview -->
                    <!-- column tools end -->

                </div>
                <!-- column repeat end -->
            </div>
        </div>
    </div>

    <umb-overlay
      ng-if="editorOverlay.show"
      model="editorOverlay"
      view="editorOverlay.view"
      position="target">
    </umb-overlay>

</div>
