<div id="examineManagement" ng-controller="Umbraco.Dashboard.ExamineManagementController as vm">

    <div ng-if="vm.viewState === 'list'">
        <umb-box>
            <umb-box-content>
                <h3 class="bold">Examine Management</h3>
            </umb-box-content>
        </umb-box>
    </div>

    <div ng-show="loading">
        <umb-load-indicator></umb-load-indicator>
    </div>

    <div ng-hide="loading">
        <div ng-if="vm.viewState === 'list'" class="umb-healthcheck-group__details">

            <div class="umb-healthcheck-group__details-group">

                <div class="umb-healthcheck-group__details-group-title">
                    <div class="umb-healthcheck-group__details-group-name">Indexers</div>
                </div>

                <div class="umb-healthcheck-group__details-checks">
                    <div class="umb-healthcheck-group__details-check">
                        <div class="umb-healthcheck-group__details-check-title">
                            <div class="umb-healthcheck-group__details-check-name">Manage Examine's indexes</div>
                            <div class="umb-healthcheck-group__details-check-description">Allows you to view the details of each index and provides some tools for managing the indexes</div>
                        </div>

                        <div class="umb-healthcheck-group__details-status" ng-repeat="indexer in vm.indexerDetails">

                            <div class="umb-healthcheck-group__details-status-icon-container">
                                <i class="umb-healthcheck-status-icon"
                                   ng-class="{'icon-check color-green' : indexer.isHealthy, 'icon-delete color-red' : !indexer.isHealthy}"></i>
                            </div>

                            <div class="umb-healthcheck-group__details-status-content">
                                <div class="umb-healthcheck-group__details-status-text">
                                    <a class="btn-link -underline" href="" ng-click="vm.showIndexInfo(indexer)">
                                        {{indexer.name}}
                                    </a>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>

            <br />

            <div class="umb-healthcheck-group__details-group">

                <div class="umb-healthcheck-group__details-group-title">
                    <div class="umb-healthcheck-group__details-group-name">Searchers</div>
                </div>

                <div class="umb-healthcheck-group__details-checks">
                    <div class="umb-healthcheck-group__details-check">
                        <div class="umb-healthcheck-group__details-check-title">
                            <div class="umb-healthcheck-group__details-check-name">Configured Searchers</div>
                            <div class="umb-healthcheck-group__details-check-description">Shows properties and tools for any configured Searcher (i.e. such as a multi-index searcher)</div>
                        </div>

                        <div class="umb-healthcheck-group__details-status" ng-repeat="searcher in vm.searcherDetails">

                            <div class="umb-healthcheck-group__details-status-icon-container">
                                <i class="umb-healthcheck-status-icon icon-info"></i>
                            </div>

                            <div class="umb-healthcheck-group__details-status-content">
                                <div class="umb-healthcheck-group__details-status-text">
                                    <a class="btn-link -underline" href="" ng-click="vm.showSearcherInfo(searcher)">
                                        {{searcher.name}}
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>

        <div ng-if="vm.viewState === 'searcher-details'">
            <!-- TODO: Add searcher properties -->
            <!-- TODO: Add search tools -->
        </div>

        <div ng-if="vm.viewState === 'index-details'">

            <umb-editor-sub-header>
                <umb-editor-sub-header-content-left>
                    <a class="umb-healthcheck-back-link" href="" ng-click="vm.setViewState('list');">&larr; Back to overview</a>
                </umb-editor-sub-header-content-left>
            </umb-editor-sub-header>


            <div class="umb-healthcheck-group__details">

                <div class="umb-healthcheck-group__details-group">

                    <div class="umb-healthcheck-group__details-group-title">
                        <div class="umb-healthcheck-group__details-group-name">{{ vm.selectedIndex.name }}</div>
                    </div>

                    <div class="umb-healthcheck-group__details-checks">

                        <div class="umb-healthcheck-group__details-check">

                            <div class="umb-healthcheck-group__details-check-title">
                                <div class="umb-healthcheck-group__details-check-name">Health status</div>
                                <div class="umb-healthcheck-group__details-check-description">The health status of the index and if it can be read</div>
                            </div>

                            <div class="umb-healthcheck-group__details-status">

                                <div class="umb-healthcheck-group__details-status-icon-container">
                                    <i class="umb-healthcheck-status-icon"
                                       ng-class="{'icon-check color-green' : vm.selectedIndex.isHealthy, 'icon-delete color-red' : !vm.selectedIndex.isHealthy}"></i>
                                </div>

                                <div class="umb-healthcheck-group__details-status-content">

                                    <div class="umb-healthcheck-group__details-status-text">
                                        <div>{{vm.selectedIndex.healthStatus}}</div>
                                        <div ng-show="!vm.selectedIndex" class="color-red">
                                            The index cannot be read and will need to be rebuilt
                                        </div>
                                        <!--<div ng-if="status.description" ng-bind-html="status.description"></div>-->
                                    </div>
                                </div>

                            </div>

                        </div>

                        <div class="umb-healthcheck-group__details-check">

                            <div class="umb-healthcheck-group__details-check-title">
                                <div class="umb-healthcheck-group__details-check-name">Index info</div>
                                <div class="umb-healthcheck-group__details-check-description">Lists the properties of the index</div>
                            </div>

                            <div class="umb-healthcheck-group__details-status">

                                <div class="umb-healthcheck-group__details-status-content">

                                    <table class="table table-bordered table-condensed">
                                        <caption>&nbsp;</caption>
                                        <tr ng-repeat="(key, val) in vm.selectedIndex.providerProperties track by $index">
                                            <th>{{key}}</th>
                                            <td>{{val}}</td>
                                        </tr>
                                    </table>

                                </div>

                            </div>

                        </div>

                        <div class="umb-healthcheck-group__details-check">

                            <div class="umb-healthcheck-group__details-check-title">
                                <div class="umb-healthcheck-group__details-check-name">Search</div>
                                <div class="umb-healthcheck-group__details-check-description">Search the index and view the results</div>
                            </div>

                            <div class="umb-healthcheck-group__details-status">

                                <div class="umb-healthcheck-group__details-status-content">

                                    <div class="umb-healthcheck-group__details-status-actions">
                                        <div class="umb-healthcheck-group__details-status-action">
                                            <ng-form name="searchTools">


                                                <div class="row form-search">
                                                    <div>
                                                        <input type="text" class="search-query" ng-model="vm.searchText" no-dirty-check />

                                                        <umb-button ng-disabled="vm.selectedIndex.isProcessing"
                                                                    type="button"
                                                                    button-style="success"
                                                                    action="vm.search(searcher)"
                                                                    label="Search">
                                                        </umb-button>

                                                        <table ng-hide="searcher.isProcessing" class="table table-bordered table-condensed">
                                                            <thead>
                                                                <tr>
                                                                    <th class="score">Score</th>
                                                                    <th class="id">Id</th>
                                                                    <th>Values</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr ng-repeat="result in searcher.searchResults">
                                                                    <td>{{result.Score}}</td>
                                                                    <td>{{result.Id}}</td>
                                                                    <td>
                                                                        <span ng-repeat="(key,val) in result.Fields track by $index">
                                                                            <span class=""><em>{{key}}</em>:</span>
                                                                            <span class="text-info">{{val}}</span>
                                                                        </span>
                                                                    </td>
                                                                </tr>
                                                            </tbody>
                                                        </table>

                                                    </div>
                                                </div>

                                            </ng-form>
                                        </div>
                                    </div>

                                </div>

                            </div>

                        </div>

                        <div class="umb-healthcheck-group__details-check">

                            <div class="umb-healthcheck-group__details-check-title">
                                <div class="umb-healthcheck-group__details-check-name">Tools</div>
                                <div class="umb-healthcheck-group__details-check-description">Tools to help manage the index</div>
                            </div>

                            <div class="umb-healthcheck-group__details-status">

                                <div class="umb-healthcheck-group__details-status-content">

                                    <div class="umb-healthcheck-group__details-status-actions">
                                        <div class="umb-healthcheck-group__details-status-action">
                                            <ng-form name="indexTools">

                                                <umb-button ng-show="!vm.selectedIndex.isProcessing && (!vm.selectedIndex.processingAttempts || vm.selectedIndex.processingAttempts < 100)"
                                                            type="button"
                                                            button-style="success"
                                                            action="vm.rebuildIndex(indexer)"
                                                            label="Rebuild index">
                                                </umb-button>

                                                <div ng-show="vm.selectedIndex.isProcessing">
                                                    <div class="umb-healthcheck-group__details-status-overlay"></div>
                                                    <umb-load-indicator></umb-load-indicator>
                                                </div>

                                                <div ng-show="vm.selectedIndex.processingAttempts >= 100">
                                                    The process is taking longer than expected, check the umbraco log to see if there have been any errors during this operation
                                                </div>

                                            </ng-form>
                                        </div>
                                    </div>

                                </div>

                            </div>

                        </div>



                    </div>

                </div>

            </div>

        </div>
    </div>

</div>
